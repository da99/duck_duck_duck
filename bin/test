#!/usr/bin/env bash
# -*- bash -*-
#
set -u -e -o pipefail

function init {
  rm -f "migrates/002-two.js"
  rm -f "migrates/003-three.js"
  rm -f "migrates/004-four.js"
  rm -f "migrates/005-five.js"
  rm -f "migrates/006-six.js"

  cp "migrates/001-one.js"  "migrates/002-two.js"
  cp "migrates/001-one.js"  "migrates/003-three.js"
}

function init_last_three {
  cp "migrates/001-one.js"  "migrates/004-four.js"
  cp "migrates/001-one.js"  "migrates/005-five.js"
  cp "migrates/001-one.js"  "migrates/006-six.js"
}

# ==== reset
MIGRATE_TABLE="_test_schema" node tests/helpers/drop.js

cd tests/user
MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck up

cd ../raven_sword
MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck up

cd ../praying_mantis
echo "" > /tmp/duck_down
rm -f "migrates/008-eight.js"
rm -f "migrates/010-ten.js"
cp "migrates/002-two.js"  "migrates/004-four.js"
cp "migrates/002-two.js"  "migrates/006-six.js"
MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck up
cp "migrates/002-two.js"  "migrates/008-eight.js"
cp "migrates/002-two.js"  "migrates/010-ten.js"
MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck down

cd ../lone_wolf
echo "" > /tmp/duck_up
init
MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck up
init_last_three
MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck up

cd ../laughing_octopus
rm -rf migrates
DUCK_TEMPLATE="../../template.js" MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck create one
DUCK_TEMPLATE="../../template.js" MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck create two
DUCK_TEMPLATE="../../template.js" MIGRATE_TABLE="_test_schema" ../../bin/duck_duck_duck create three


cd ../..
mocha tests/duck_duck_duck.js

#!/usr/bin/env node
# -*- js   -*-
#


